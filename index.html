<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Open Graph / WhatsApp -->
  <meta property="og:title" content="Invitación · Cumpleaños de Sofi">
  <meta property="og:description" content="Te esperamos para celebrar el cumple de Sofi">
  <meta property="og:image" content="https://i.ibb.co/XkGrvFMq/SOFIA-1.png">
  <meta property="og:url" content="https://sofianunez.netlify.app/">
  <meta property="og:type" content="website">

  <!-- Tamaño exacto recomendado -->
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <title>Invitación - Cumpleaños de Sofi</title>
  <style>
    /* Cargar SF Pro Rounded — usar archivo local primero, fallback remoto */
    @font-face {
      font-family: 'SF Pro Rounded';
      src: url('sf-pro-rounded_regular.woff2') format('woff2'),
           url('https://www.apple.com/wss/fonts/SF-Pro-Rounded/v1/sf-pro-rounded_regular.woff2') format('woff2');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    :root{
      --white:#ffffff;
      --pill-bg: rgba(0,0,0,0.45);
      --pill-border: rgba(255,255,255,0.08);
      --page-bg: #2b2b2b; /* fondo general de la página (gris oscuro) */
    }
    html,body{height:100%;margin:0;}
    body{
      font-family: 'SF Pro Rounded', Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color:var(--white);
      background:var(--page-bg);
      overflow:hidden; /* usar un contenedor interno para el scroll */
    }

    /* Contenedor de ventana con máscara superior para desvanecer elementos al subir */
    .viewport{
      position:fixed;
      inset:0;
      overflow:auto;
      -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 33%, rgba(0,0,0,1) 100%);
      mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 33%, rgba(0,0,0,1) 100%);
      -webkit-mask-repeat: no-repeat;
      mask-repeat: no-repeat;
      -webkit-mask-size: 100% 100vh;
      mask-size: 100% 100vh;
      -webkit-overflow-scrolling: touch;
      z-index:1; /* encima del fondo pero debajo de topbar */
    }

    /* Fullscreen background image (keeps aspect ratio, no stretch) */
    .bg{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      object-fit:cover;
      object-position:center;
      z-index:-1;
      display:block;
    }

    /* Rectángulo superior fijo para cubrir la barra iOS (safe-area aware) */
    .topbar{
      position:fixed;
      left:0; right:0; top:0;
      height:calc(env(safe-area-inset-top, 20px) + 10px);
      background:var(--page-bg);
      z-index:10000;
      pointer-events:none;
    }

    /* Texto exactamente en el centro de la pantalla, desplazado 25px hacia abajo */
    .centered {
      /* layout estable: en flujo normal y centrado horizontalmente */
      position:static;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:20px;
      padding:40px 20px;
      box-sizing:border-box;
      text-align:center;
      margin-top:130px;
      margin-bottom:0;
      width:100%;
      max-width:720px;
      pointer-events:auto;
    }

    .centered > * { pointer-events:auto; }

    .prelead{
      display:flex;
      align-items:center;
      justify-content:center;
      color:#ffffffad;
      font-family: 'SF Pro', 'SF Pro Rounded', Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-size:17px;
      gap:normal;
      margin:0px 16px 8px;
      padding:2px 0px;
      text-align:center;
      text-shadow:#0003 0px 0px 5px;
    }

    .spacer{height:240px;width:100%;display:block;background:transparent;pointer-events:none}

    h1{
      margin:-2px 0px;
      display:flow-root;
      font-family: 'SF Pro Rounded', 'SF Pro', Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-size:34px;
      font-weight:600;
      gap:normal;
      padding:0px 5px;
      letter-spacing:1px;
      color:#fff;
      text-align:center;
      line-height:1;
    }
    .lead{
      display:flex;
      align-items:center;
      justify-content:center;
      color:#ffffffad;
      font-family: 'SF Pro', 'SF Pro Rounded', Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-size:15px;
      gap:normal;
      margin:0px 16px;
      padding:2px 0px;
      text-align:center;
      text-shadow:#0003 0px 0px 5px;
      line-height: 20px;
      
    }
    .when{
      display:flex;
      align-items:center;
      justify-content:center;
      color:#ffffffad;
      font-family: 'SF Pro', 'SF Pro Rounded', Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-size:14px;
      gap:normal;
      margin:0px 16px;
      padding:2px 0px;
      text-align:center;
      text-shadow:#0003 0px 0px 5px;
    }

    /* RSVP: una sola pastilla alargada con tres opciones internas */
    .rsvp{
      display:flex;
      justify-content:center;
      width:100%;
      padding:0 16px;
      box-sizing:border-box;
    }
    .rsvp .rsvp-group{
      display:flex;
      gap:8px;
      align-items:center;
      background: var(--pill-bg); /* mismo color que .pill */
      border:1px solid var(--pill-border);
      border-radius:36px;
      height:44px;
      padding:6px;
      box-shadow:0 12px 30px rgba(0,0,0,0.45);
      backdrop-filter: blur(4px);
      width:100%;
      max-width:420px; /* igual que .actions max-width */
      margin:0 auto;
    }
    .rsvp .rsvp-option{
      flex:1 1 0;
      width:0; /* forzar reparto igual entre flex items */
      min-width:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      background:transparent;
      border-radius:28px;
      padding:0 6px; /* mantener altura pero reducir padding horizontal */
      color:var(--white);
      text-decoration:none;
      cursor:pointer;
      border:0;
      text-align:center;
      white-space:nowrap;
      overflow:hidden;
    }
    .rsvp .rsvp-option:hover{ background: rgba(255,255,255,0.02); }
    .rsvp .rsvp-icon{ font-size:16px; line-height:1; margin-bottom:2px }
    .rsvp .rsvp-text{ font-size:13px; font-weight:700; }

    /* Bottom pills (stacked) */
    .actions{
      /* poner en flujo normal debajo del contenido; la separación se controla mediante el gap de .centered */
      position:static;
      width:100%;
      max-width:720px;
      margin:0 auto 80px;
      display:flex;
      flex-direction:column;
      gap:32px;
      align-items:center;
      pointer-events:auto;
    }

    .pill{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      width:100%;
      box-sizing:border-box; /* incluir padding en el ancho */
      padding:14px 16px;
      border-radius:14px;
      background:var(--pill-bg);
      border:1px solid var(--pill-border);
      color:var(--white);
      text-decoration:none;
      box-shadow:0 12px 30px rgba(0,0,0,0.45);
    }
    /* variante cuadrada para las pastillas inferiores */
    /* variante caja 120x120 para las pastillas inferiores (una por renglón) */
    .pill.pill--box{
      width:318.4px;
      height:260px;
      padding:16px;
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      justify-content:flex-start;
      border-radius:20px; /* mismo 'round' */
      background:var(--pill-bg);
      border:1px solid var(--pill-border);
      margin:0 auto; /* centrar la caja */
    }
    .pill.pill--box .left{ display:flex; flex-direction:column; gap:6px; width:100%; box-sizing:border-box; letter-spacing: 0.5px; }
    .pill.pill--box .title{ font-size:13px; letter-spacing: 0.5px; }
    .pill.pill--box .sub{ font-size:12px; opacity:0.9; }
    .pill.pill--box .icon{ width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center }
    /* variante específica para Ubicación: imagen de fondo y título arriba izquierda */
    .pill.pill--location{
      position:relative;
      background-image: url('https://i.ibb.co/zVJ37Mfq/Captura-de-pantalla-2025-12-28-211827.png');
      background-size:cover;
      background-position:center;
      color:var(--white);
      overflow:hidden;
      border:1px solid var(--pill-border);
      border-radius:14px;
    }

    /* Degradado sutil desde arriba (50% opacidad) hasta 0% a la mitad, con blur */
    .pill.pill--location::before{
      content:"";
      position:absolute;
      left:0; right:0; top:0;
      height:50%; /* se funde hasta la mitad */
      background: linear-gradient(to bottom, rgba(35,35,35,0.5) 0%, rgba(35,35,35,0) 60%);
      filter: blur(6px);
      pointer-events:none;
      border-top-left-radius:14px;
      border-top-right-radius:14px;
    }

    .pill.pill--location .left{
      position:absolute;
      top:10px;
      left:10px;
      display:block;
      align-items:flex-start;
      color:var(--white);
      padding:4px 6px; /* padding mínimo */
      max-width:calc(100% - 20px);
      box-sizing:border-box;
    }

    /* Título más grande y sin icono en la pastilla de ubicación */
    .pill.pill--location .title{ font-size:17px; }
    .pill.pill--location .icon{ display:none; }
    /* asegurar que .pill--location aún respete tamaño 120x120 */
    .pill.pill--location{ width:318.4px; height:318.4px; padding:16px; box-sizing:border-box; margin:0 auto }
    .pill.pill--location .sub{ display:none; }
    .pill.pill--location .title{ font-size:17px; margin:0; padding:0; text-align:left; }
    .pill .left{display:flex;flex-direction:column;align-items:flex-start}
    .title{font-weight:800; letter-spacing:1px;}
    .sub{font-size:13px; opacity:0.95; margin-top:4px; letter-spacing:1px;}
    .icon{width:36px;height:36px;display:inline-flex;align-items:center;justify-content:center;flex:0 0 36px}

    /* Variante para la pastilla de Información: título arriba-izquierda, icono oculto, degradado a la derecha */
    .pill.pill--info{
      position:relative;
      overflow:hidden;
      border-radius:20px;
      border:1px solid var(--pill-border);
    }
    .pill.pill--info .left{
      position:absolute;
      top:10px;
      left:10px;
      padding:8px 10px; /* un poco más de espacio para legibilidad */
      box-sizing:border-box;
      color:var(--white);
      max-width:calc(100% - 20px);
      text-align:left;
      align-items:flex-start;
    }
    .pill.pill--info .title{ font-size:21px; margin:0; padding:0; text-align:left; letter-spacing: -0px; }
    .pill.pill--info .sub{ font-size:16px; margin-top:8px; opacity:0.95; text-align:left; letter-spacing: -0px;}
    .pill.pill--info .icon{ display:none; }

    @media(min-width:760px){
      .actions{max-width:520px}
    }
    .footer{ font-size:15.5px; color: rgba(255,255,255,0.75); margin-top:6px; text-align:center; }
  </style>
</head>
<body>
  <img class="bg" src="https://i.ibb.co/CpVzs0bQ/Captura-de-pantalla-2025-12-28-194930.png" alt="Fondo Sofi">
  <div class="topbar" aria-hidden="true"></div>

  <div class="viewport">
    <div class="centered" role="group" aria-label="Texto central invitación">
    <div class="spacer" aria-hidden="true"></div>
    <p class="prelead">Te invito al</p>
    <h1>¡Cumple de Sofi!</h1>
    <p class="lead">Acompañame a esperar las 12.<br>
    dom, 4 ene 2026, 20:30 - lun, 5 ene 2026, ?<br>
    Francisco Pizarro, Asunción, Paraguay</p>

    <div class="rsvp" role="group" aria-label="Opciones de asistencia">
      <div class="rsvp-group" role="radiogroup" aria-label="Respuesta asistencia">
        <button class="rsvp-option" type="button" data-status="Asistire">
          <div class="rsvp-icon" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 -90 120 110" fill="currentColor" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
              <path d="M 59.1797 15.1855 C 86.7676 15.1855 109.619 -7.61719 109.619 -35.2539 C 109.619 -62.8418 86.7676 -85.6934 59.1309 -85.6934 C 31.543 -85.6934 8.74023 -62.8418 8.74023 -35.2539 C 8.74023 -7.61719 31.5918 15.1855 59.1797 15.1855 Z M 59.1797 5.27344 C 36.7188 5.27344 18.7012 -12.793 18.7012 -35.2539 C 18.7012 -57.7148 36.6699 -75.7324 59.1309 -75.7324 C 81.5918 -75.7324 99.6582 -57.7148 99.707 -35.2539 C 99.707 -12.793 81.6406 5.27344 59.1797 5.27344 Z M 53.9062 -12.0605 C 55.6641 -12.0605 57.1777 -12.9395 58.2031 -14.502 L 80.0293 -48.6328 C 80.6641 -49.6582 81.25 -50.8301 81.25 -51.9531 C 81.25 -54.3457 79.1016 -55.957 76.8066 -55.957 C 75.3418 -55.957 74.0234 -55.1758 72.998 -53.5156 L 53.7109 -22.5586 L 44.6289 -34.1309 C 43.457 -35.6445 42.2852 -36.1816 40.8691 -36.1816 C 38.4766 -36.1816 36.5723 -34.2773 36.5723 -31.8359 C 36.5723 -30.6641 37.0117 -29.5898 37.8418 -28.5645 L 49.3652 -14.502 C 50.6836 -12.793 52.0996 -12.0605 53.9062 -12.0605 Z"/>
            </svg>
          </div>
          <div class="rsvp-text">Asistiré</div>
        </button>

        <button class="rsvp-option" type="button" data-status="No asistire">

          <div class="rsvp-icon" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 -90 120 110" fill="currentColor" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
              <path d="M 59.1797 15.1855 C 86.7676 15.1855 109.619 -7.61719 109.619 -35.2539 C 109.619 -62.8418 86.7676 -85.6934 59.1309 -85.6934 C 31.543 -85.6934 8.74023 -62.8418 8.74023 -35.2539 C 8.74023 -7.61719 31.5918 15.1855 59.1797 15.1855 Z M 59.1797 5.27344 C 36.7188 5.27344 18.7012 -12.793 18.7012 -35.2539 C 18.7012 -57.7148 36.6699 -75.7324 59.1309 -75.7324 C 81.5918 -75.7324 99.6582 -57.7148 99.707 -35.2539 C 99.707 -12.793 81.6406 5.27344 59.1797 5.27344 Z M 43.1152 -14.7461 C 44.3359 -14.7461 45.459 -15.1855 46.2891 -16.0645 L 59.1309 -28.9551 L 72.0703 -16.0645 C 72.9004 -15.2344 73.9746 -14.7461 75.2441 -14.7461 C 77.6855 -14.7461 79.6387 -16.6992 79.6387 -19.1895 C 79.6387 -20.3613 79.1992 -21.4355 78.3203 -22.2656 L 65.4297 -35.2051 L 78.3691 -48.1934 C 79.248 -49.0723 79.6875 -50.0977 79.6875 -51.2695 C 79.6875 -53.7109 77.7344 -55.6641 75.293 -55.6641 C 74.0723 -55.6641 73.0957 -55.2246 72.168 -54.2969 L 59.1309 -41.3574 L 46.1914 -54.248 C 45.3613 -55.127 44.3359 -55.5664 43.1152 -55.5664 C 40.625 -55.5664 38.6719 -53.6621 38.6719 -51.2207 C 38.6719 -50.0488 39.1602 -48.9746 40.0391 -48.1445 L 52.9297 -35.2051 L 40.0391 -22.2168 C 39.1602 -21.4355 38.6719 -20.3613 38.6719 -19.1895 C 38.6719 -16.6992 40.625 -14.7461 43.1152 -14.7461 Z"/>
            </svg>
          </div>
          <div class="rsvp-text">No asistiré</div>
        </button>

        <button class="rsvp-option" type="button" data-status="Quizas">
          <div class="rsvp-icon" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 -90 120 110" fill="currentColor" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
              <path d="M 59.1797 15.1855 C 86.7676 15.1855 109.619 -7.61719 109.619 -35.2539 C 109.619 -62.8418 86.7676 -85.6934 59.1309 -85.6934 C 31.543 -85.6934 8.74023 -62.8418 8.74023 -35.2539 C 8.74023 -7.61719 31.5918 15.1855 59.1797 15.1855 Z M 59.1797 5.27344 C 36.7188 5.27344 18.7012 -12.793 18.7012 -35.2539 C 18.7012 -57.7148 36.6699 -75.7324 59.1309 -75.7324 C 81.5918 -75.7324 99.6582 -57.7148 99.707 -35.2539 C 99.707 -12.793 81.6406 5.27344 59.1797 5.27344 Z M 58.0566 -25.5371 C 60.7422 -25.5371 62.4512 -27.0508 62.5977 -29.0527 C 62.5977 -29.248 62.5977 -29.4922 62.5977 -29.6387 C 62.7441 -32.1777 64.502 -33.8867 67.6758 -35.9375 C 72.4609 -39.1113 75.5859 -41.8945 75.5859 -47.5586 C 75.5859 -55.7129 68.2617 -60.3516 59.6191 -60.3516 C 51.2695 -60.3516 45.5566 -56.543 44.043 -51.9531 C 43.75 -51.123 43.6035 -50.293 43.6035 -49.4141 C 43.6035 -47.0703 45.459 -45.6055 47.6074 -45.6055 C 50.4883 -45.6055 51.123 -47.0703 52.6367 -48.7793 C 54.1992 -51.2207 56.2988 -52.6367 59.1797 -52.6367 C 63.1348 -52.6367 65.6738 -50.3906 65.6738 -47.0703 C 65.6738 -44.043 63.623 -42.4805 59.4727 -39.5996 C 56.0059 -37.207 53.4668 -34.668 53.4668 -30.2246 L 53.4668 -29.6875 C 53.4668 -26.9531 55.127 -25.5371 58.0566 -25.5371 Z M 58.0078 -10.5469 C 61.1328 -10.5469 63.7207 -12.8418 63.7207 -15.918 C 63.7207 -18.9941 61.1328 -21.2402 58.0078 -21.2402 C 54.834 -21.2402 52.2949 -18.9453 52.2949 -15.918 C 52.2949 -12.8418 54.8828 -10.5469 58.0078 -10.5469 Z"/>
            </svg>
          </div>
          <div class="rsvp-text">Quizás</div>
        </button>
      </div>
    </div>

    <div class="actions" aria-hidden="false">
    <a class="pill pill--box pill--info" href="#" onclick="event.preventDefault(); alert('Lugar:\n25°19\'08.7\"S 57°37\'59.1\"W');" aria-label="Información del lugar">
      <div class="left">
        <div class="title">Información del Evento</div>
        <div class="sub">Vamos a celebrar el cumple de Sofi el 4 de enero y nos quedamos hasta pasar al 5, ya que ese día es su cumple de verdad, para recibir las doce juntos.
            <br>
            <br>
            La casa es la 4239.
            <br>
            cuenta con un cartel de la empresa Cen.
            <br>
            <br>
            ¡El que no trae regalo no entra!</div>
      </div>
      <div class="icon" aria-hidden="true">ℹ️</div>
    </a>
    

    <a class="pill pill--box pill--location" href="https://www.google.com/maps/search/?api=1&query=-25.3190833,-57.6330833" target="_blank" rel="noopener noreferrer" aria-label="Ubicación">
      <div class="left">
        <div class="title">Ubicación</div>
        <div class="sub">25°19'08.7"S 57°37'59.1"W</div>
      </div>
    
    </a>
    <footer class="footer" aria-hidden="true">Desarrollado por Mauricio Ocampo.</footer>
    </div>
    </div>
  </div>
</div>

<!-- RSVP Modal (insertado por script) -->
<div id="rsvp-modal-overlay" aria-hidden="true">
  <div id="rsvp-modal" role="dialog" aria-modal="true" aria-labelledby="rsvp-title">
    <h2 id="rsvp-title">Confirmar asistencia</h2>
    <label for="rsvp-name" class="visually-hidden">Nombre y apellido</label>
    <input id="rsvp-name" type="text" placeholder="Nombre y apellido" autocomplete="name" />
    <div id="rsvp-error" aria-live="polite"></div>
    <div class="rsvp-modal__btns">
      <button id="rsvp-cancel" type="button">Cancelar</button>
      <button id="rsvp-confirm" type="button">Confirmar</button>
    </div>
  </div>
</div>

<style>
  /* Modal styles (scoped, won't override existing classes) */
  #rsvp-modal-overlay{position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    border-radius:20px;
    z-index:20000;
    opacity:0;pointer-events:none;transition:opacity .28s ease}
  #rsvp-modal-overlay[aria-hidden="false"]{opacity:1;pointer-events:auto}
  #rsvp-modal-overlay::backdrop{background:transparent}
  #rsvp-modal-overlay::before{content:"";position:fixed;inset:0;background:rgba(0,0,0,0.45);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);}
  #rsvp-modal{position:relative;min-width:280px;max-width:520px;width:100%;background:#161616;border-radius:16px;padding:20px 18px;box-shadow:0 20px 40px rgba(0,0,0,0.6);transform:translateY(6px) scale(.98);opacity:0;transition:transform .28s cubic-bezier(.2,.9,.2,1),opacity .28s ease;z-index:20001;border:1px solid rgba(255,255,255,0.06);font-family: 'SF Pro Rounded', 'SF Pro', Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;color:var(--white)}
  #rsvp-modal-overlay[aria-hidden="false"] #rsvp-modal{transform:translateY(0) scale(1);opacity:1}
  #rsvp-modal h2{margin:0 0 12px 0;font-size:18px;letter-spacing:0.4px}
  #rsvp-name{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:#242424fa;color:var(--white);font-size:15px;box-sizing:border-box;outline:none}
  #rsvp-name:focus{box-shadow:0 6px 18px rgba(0,0,0,0.6);border-color:rgba(255,255,255,0.2)}
  #rsvp-error{height:18px;margin:8px 0 0;color:#ffb3b3;font-size:13px;opacity:0;transition:opacity .18s ease}
  #rsvp-error.show{opacity:1}
  .rsvp-modal__btns{display:flex;gap:10px;justify-content:flex-end;margin-top:16px}
  #rsvp-cancel,#rsvp-confirm{padding:10px 14px;border-radius:10px;border:0;font-weight:700;cursor:pointer}
  #rsvp-cancel{background:transparent;color:var(--white);border:1px solid rgba(255,255,255,0.06)}
  #rsvp-confirm{background:#0a84ff;color:white;display:inline-block;min-width:64px;box-sizing:border-box;transition:width .18s ease,transform .12s ease}
  .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
  /* Darken RSVP option when already sent (solid color) */
  .rsvp-option.rsvp-sent{background:#02020224;color:rgba(255,255,255,0.85);pointer-events:none;opacity:1; height: 45px;}
  .rsvp-option.rsvp-sent .rsvp-icon{opacity:0.9}
</style>
</style>

<script>
(function(){
  const GFORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSdeYS_yNAYLqwSzfyEtIkd88Md6czYElPkSy0ah8M1-KV6IwA/formResponse';

  // Utils
  function pad(n){ return n < 10 ? '0'+n : n; }
  function formatDateTime(d){
    return pad(d.getDate())+'/'+pad(d.getMonth()+1)+'/'+d.getFullYear()+
           ' '+pad(d.getHours())+':'+pad(d.getMinutes());
  }

  // Modal elements
  const overlay = document.getElementById('rsvp-modal-overlay');
  const titleEl = document.getElementById('rsvp-title');
  const nameInput = document.getElementById('rsvp-name');
  const errorEl = document.getElementById('rsvp-error');
  const btnCancel = document.getElementById('rsvp-cancel');
  const btnConfirm = document.getElementById('rsvp-confirm');

  let selectedStatus = '';
  let selectedButton = null;

  function openModal(status){
    selectedStatus = status;

    if(status === 'Asistire') titleEl.textContent = 'Confirmar asistencia';
    else if(status === 'No asistire') titleEl.textContent = 'Confirmar que no asistirás';
    else titleEl.textContent = 'Confirmar quizá';

    nameInput.value = '';
    errorEl.textContent = '';
    errorEl.classList.remove('show');
    overlay.setAttribute('aria-hidden','false');
    // size Confirm button to match the originating pill minus 10px for padding
    setTimeout(()=>{
      nameInput.focus();
      try{
        if(selectedButton && btnConfirm){
          const rect = selectedButton.getBoundingClientRect();
          const w = Math.max(40, Math.round(rect.width - 10));
          btnConfirm.style.width = w + 'px';
        } else {
          btnConfirm.style.width = '';
        }
      }catch(e){ btnConfirm.style.width = ''; }
    }, 50);
  }

  function closeModal(){
    overlay.setAttribute('aria-hidden','true');
    // reset confirm width
    try{ btnConfirm.style.width = ''; }catch(e){}
  }

  btnCancel.addEventListener('click', closeModal);

  document.addEventListener('keydown', e=>{
    if(overlay.getAttribute('aria-hidden') === 'false'){
      if(e.key === 'Escape') closeModal();
      if(e.key === 'Enter' && document.activeElement === nameInput){
        btnConfirm.click();
      }
    }
  });

  function attachToButtons(){
    document.querySelectorAll('.rsvp-option').forEach(btn=>{
      btn.removeAttribute('onclick');
      const status = btn.dataset.status;
      if(!status) return;
      btn.addEventListener('click', ()=>{
        selectedButton = btn;
        openModal(status);
      });
    });
  }

  btnConfirm.addEventListener('click', ()=>{
    const name = nameInput.value.trim();
    if(!name){
      errorEl.textContent = 'Por favor, ingresa nombre y apellido.';
      errorEl.classList.add('show');
      return;
    }

    const payload = new URLSearchParams();
    payload.append('entry.1455239527', name);
    payload.append('entry.1134878422', selectedStatus);
    payload.append('entry.2088812563', formatDateTime(new Date()));

    fetch(GFORM_URL, {
      method:'POST',
      mode:'no-cors',
      body: payload
    });

    // Persist and visually mark the originating button as sent
    try{ localStorage.setItem('rsvpStatus', selectedStatus); }catch(e){}
    markAsSent(selectedStatus, selectedButton);

    titleEl.textContent = 'Enviado. ¡Gracias!';
    setTimeout(closeModal, 1200);
  });

  // Mark button visually and disable it
  function markAsSent(status, btn){
    const button = btn || document.querySelector('.rsvp-option[data-status="'+status+'"]');
    if(!button) return;
    button.classList.add('rsvp-sent');
    try{ button.setAttribute('disabled',''); }catch(e){}
    button.setAttribute('aria-pressed','true');
  }

  // Apply persisted selection on load
  try{
    const persisted = localStorage.getItem('rsvpStatus');
    if(persisted){
      // attach first then mark
      attachToButtons();
      setTimeout(()=> markAsSent(persisted), 50);
      return;
    }
  }catch(e){}

  attachToButtons();
})();
</script>
</body>
</html>
